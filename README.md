# Video Copier

Сервис для репликации структуры видео-редактирования с использованием технологий машинного обучения.

## Описание проекта

Video Copier - это инструмент, который анализирует структуру редактирования исходного видео и применяет эту структуру к новому видео, сохраняя стиль, переходы и эффекты. Проект использует наборы данных AVE и Edit3K для анализа и детектирования эффектов.

## Структура проекта

```
video_copier/
├── frontend/               # Angular frontend
│   ├── angular/
│   │   ├── src/
│   │   │   ├── app/
│   │   │   │   ├── components/
│   │   │   │   ├── services/
│   │   │   │   └── models/
│   │   │   ├── assets/
│   │   │   └── environments/
├── backend/                # Python backend
│   ├── python/
│   │   ├── app/            # Основной пакет приложения
│   │   │   ├── __init__.py # Инициализация пакета и управление путями
│   │   │   ├── app.py      # Flask приложение и конфигурация
│   │   │   ├── config.py   # Конфигурация параметров приложения
│   │   │   ├── controllers/# Контроллеры API
│   │   │   ├── models/     # Модели для работы с данными и алгоритмами
│   │   │   ├── services/   # Бизнес-логика и сервисы
│   │   │   └── utils/      # Утилиты проекта
│   │   └── tests/
│   ├── ai_service/         # AI сервис для анализа видео
│   │   ├── models/
│   │   ├── data/
│   │   └── notebooks/
│   ├── config/             # Конфигурационные файлы
│   └── scripts/            # Скрипты для запуска и тестирования
```

## Технологии

### Backend
- Python 3.8+
- Flask (REST API)
- TensorFlow/PyTorch (для моделей машинного обучения)
- OpenCV (для анализа видео)
- MoviePy (для редактирования видео)
- ffmpeg-python (для высокопроизводительных операций с видео)

### Frontend
- Angular 14+
- TypeScript
- Angular Material
- RxJS

## Реализованные компоненты

### Ядро системы
- **VideoAnalyzer** - анализ видео, определение границ сцен, детекция эффектов
- **DatasetManager** - управление наборами данных AVE и Edit3K
- **VideoEditor** - применение структуры редактирования к новому видео
- **EffectsLibrary** - библиотека эффектов и переходов

### Оптимизация и утилиты
- **VideoUtils** - утилиты для работы с видео через ffmpeg и OpenCV
- **MemoryManager** - оптимизация использования памяти для больших файлов
- **CacheManager** - кеширование результатов для ускорения повторной обработки
- **DatasetOptimizer** - оптимизация загрузки и хранения датасетов

### Системные компоненты
- Централизованное логирование во всех модулях
- Обработка ошибок и исключений
- Отказоустойчивый импорт компонентов
- Автоматическое создание необходимых директорий

## API Endpoints

| Endpoint                | Метод | Описание |
|-------------------------|-------|----------|
| `/api/analyze`          | POST  | Анализ видео и определение структуры редактирования |
| `/api/apply-structure`  | POST  | Применение структуры редактирования к новому видео |
| `/api/results/<filename>` | GET | Получение результата обработки по имени файла |
| `/api/health`           | GET   | Проверка работоспособности API |

## Установка и запуск

### Требования
- Python 3.8+
- Node.js 14+
- npm 7+
- CUDA (опционально, для GPU-ускорения)
- FFmpeg (должен быть установлен и доступен в переменной PATH)

### Установка бэкенда

```bash
# Создание виртуальной среды
python -m venv venv
source venv/bin/activate  # На Windows: venv\Scripts\activate

# Установка зависимостей
pip install -r backend/requirements.txt

# Запуск сервера
python backend/python/run.py
```

### Установка фронтенда

```bash
# Установка зависимостей
cd frontend/angular
npm install

# Запуск dev-сервера
npm start
```

## Использование

1. Загрузите исходное видео, структуру редактирования которого вы хотите скопировать
2. Система проанализирует видео и определит его структуру редактирования
3. Загрузите целевое видео, к которому нужно применить эту структуру
4. Получите результат - видео с примененной структурой редактирования

## Особенности реализации

### Синергия MoviePy и ffmpeg-python
В проекте применяется комбинированный подход к обработке видео:

1. **MoviePy** - для высокоуровневых операций редактирования и эффектов
   - Удобный Python API для монтажа и композиции видео
   - Широкие возможности по созданию переходов и эффектов
   - Простота использования для творческих задач

2. **ffmpeg-python** - для низкоуровневых операций, требующих максимальной производительности
   - Прямые вызовы FFmpeg для ускорения критичных операций
   - Оптимизация работы с большими файлами
   - Эффективное извлечение кадров, нарезка видео и конвертация форматов
   - Низкое потребление памяти

### Обработка больших файлов
- Сегментированный подход для видео > 500 MB или > 5 минут
- Оптимизация использования памяти с помощью `MemoryManager`
- Контроль потребления памяти и автоматическая сборка мусора
- Батчевая обработка кадров для эффективного использования GPU

### Устойчивость к ошибкам
- Отказоустойчивый импорт компонентов с обработкой исключений
- Заглушки для недоступных классов и модулей
- Подробное логирование на всех этапах обработки
- Автоматический переход на резервные методы при ошибках

## Наборы данных

Проект использует следующие датасеты:
- **AVE (Audio-Visual Event)** - для анализа сцен и типов съемки
- **Edit3K** - для детектирования эффектов и переходов

## Лицензия

MIT 